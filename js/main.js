var meta = {
  site: "businessweek", // e.g. "businessweek"
  author: "Dude", // e.g. "Claire Suddath"
  type: "graphic", // e.g. "graphic"
  section: "Lifestyle", // e.g. "Lifestyle"
  title: "What to wear to the office this fall", // e.g. "Can women ever win at work?"
  pubDate: "20140828", // e.g. "20140825"
  shareText: "Omg I love clothes"
};

var data = [{"spread":1,"id":0,"type":"intro","hed":"","dek":"It's time to start dressing up again. Over the past 10 years, workwear has gotten increasingly casual, to the point where everyone from the intern to the boss is wearing sneakers and jeans. Perhaps you haven't heard that informal office environments are linked with lower productivity. If that's not enough to get you into a suit or dress, the fantastic array of more formal clothing landing in stores this fall should be. We've compiled 50 tips and trends to help you get back to looking like you're ready to do business or, at the very least, stop treating every day like casual Friday. As some good book said: Dress for the job you wish you had.","credit":"Jenni Kayne narrow stripe pullover, $595. Frame Le Classic blouse, $188. Helmut Lang veneered angora skirt, $495. Topshop guapa suede Mary Janes, $100. Hermès watch, $8,700","photocredit":"Photograph by B. Blanchet for Bloomberg Businessweek; Hair and makeup: Kyle Malone/Exclusive Artists. Illustrations by Cari Vander Yacht","imgType":"png","imgSmall":"0_small.png","imgLarge":"0_large.png","imgSize":null},
{"spread":1,"id":1,"type":"general","hed":"Long Camel Coats","dek":"The official jacket of the Ivy League gets a much-needed makeover with a longer length and more casual fit for both men and women. The coat should fit in the shoulder and sleeves and billow out from the body a bit. Shorter women, stick with knee-length.","credit":"Him: Calvin Klein lofty cashmere overcoat, $4,995. Steven Alan Oliver suit jacket, $495, and pants, $295. Thomas Pink button-cuff shirt, $185. Saint Laurent Classic 1 sunglasses, $310. Ralph Lauren burnished-calf loafers, $475. Her: Tibi cashmere maxi coat, $845. Derek Lam bonded-crepe turtleneck, $890. Michael Kors houndstooth circle skirt, $110. Karen Walker northern lights sunglasses, $250. Chrissie Morris pointed-toe pumps, $830","photocredit":"Photograph by Geordie Wood for Bloomberg Businessweek; hair and makeup: Kyle Malone/Exclusive Artists","imgType":"png","imgSmall":"1_small.png","imgLarge":"1_large.png","imgSize":null},
{"spread":1,"id":2,"type":"general","hed":"Leather Separates","dek":"A motorcycle jacket is a bit too rock 'n' roll for the office, but skirts and tops are fair game. Wear with other dark pieces to add texture—and prove to colleagues you've still got a little edge.","credit":"Alexander Wang sleeveless shirt, price upon request. Cushnie et Ochs leather mini trumpet skirt, $1,495","photocredit":"Photograph by Jody Rogac for Bloomberg Businessweek; soft-goods stylist: Elizabeth Osborn","imgType":"png","imgSmall":"2_small.png","imgLarge":"2_large.png","imgSize":null},
{"spread":1,"id":3,"type":"experiment","hed":"A Non-Nerdy Sweater Vest","dek":"They're practical and preppy and seem like the perfect thing to wear in early fall's in-between weather. This comfy mohair Saint Laurent vest ($725 at mrporter.com), with its argyle pattern and slimmer silhouette, looked great on the rack. I imagined it would become my new go-to garment—a contemporary version of an old-school item that looks just as cool now as it did in the Fifties. But, actually, I looked sort of lame. When I put the V-neck on over a dress shirt, the V was a little too low, and the whole thing read too math-teachery. I'm not giving up just yet: Next week, I'm trying it with a navy blazer. Maybe then.","credit":"","photocredit":"Photograph by B. Blanchet for Bloomberg Businessweek; hair and makeup: Kyle Malone/Exclusive Artists","imgType":"png","imgSmall":"3_small.png","imgLarge":"3_large.png","imgSize":null},
{"spread":1,"id":4,"type":"quote","hed":"Jeremy Langmead","dek":"I’m pleased to see looser pants come back. They enable you to carry things in your pocket once more.","credit":"Chief content officer, Christie’s","photocredit":"","imgType":"png","imgSmall":"4_small.png","imgLarge":"4_large.png","imgSize":null},
{"spread":1,"id":5,"type":"rant","hed":"Put Down the Beanie","dek":"The hipster's favorite winter accessory may have gone mainstream, but that doesn't mean these dumb little hats are a good idea. They're not particularly warm and always leave you with hat hair. On truly cold days, stick with a coat that has a hood.","credit":"","photocredit":"Photograph by Eva O’Leary for Bloomberg Businessweek; soft-goods stylist: John Olsen","imgType":"png","imgSmall":"5_small.png","imgLarge":"5_large.png","imgSize":null},
{"spread":1,"id":6,"type":"general","hed":"Vermilion: The Color of the Season","dek":"Red gets a bad rap, even though it's surprisingly flattering for most people—sorry, redheads—and pops nicely against neutrals. On the runways, almost every major designer showed head-to-toe vermilion looks, often created from many separates in the same fabric. That's far too intense for most workplaces (and most humans). Instead, buy one piece you love and wear it alone or with other basics. It will be great for when you've got an after-work dinner and don't want to look like an office drone.","credit":"Left: Prada silk dress, $3,040. Hermès yellow-gold bracelet, $15,200. Topshop guapa suede Mary Janes (also at right), $100. Center: Ami unlined hooded wool coat, $900. Michael Michael Kors glacier check shirt, $125. Polo Ralph Lauren classic-fit chinos, $85. Cole Haan for Todd Snyder boots, price upon request. Right: Tory Burch Kendra dress, $425. Hue opaque tights, $13.50","photocredit":"Photographs by B. Blanchet for Bloomberg Businessweek; hair and makeup: Kyle Malone/Exclusive Artists","imgType":"gif","imgSmall":"6_small.gif","imgLarge":"6_large.gif","imgSize":null},
{"spread":1,"id":7,"type":"general","hed":"Mixed-Material Accessories","dek":"Stuart Weitzman's shearling and leather handbag ($900) represents the next iteration of the color-blocking trend. If this fuzzy texture isn't for you, seek out similar bags and shoes that incorporate different types of leather, snakeskin, and synthetics such as neoprene. Or try on Weitzman's women's brogues ($395), featuring a sleek combination of matte and ","credit":"","photocredit":"Photograph by Jody Rogac for Bloomberg Businessweek; soft-goods stylist: Elizabeth Osborn","imgType":"png","imgSmall":"7_small.png","imgLarge":"7_large.png","imgSize":null},
{"spread":2,"id":9,"type":"makeover","hed":"Kate Pratt, 26 Director of team partnership sales, Madison Square Garden","dek":"I find sponsorship partners, and I'm in meetings with clients in my usual classic style from breakfast until 10 p.m. I also wear the same pumps and jewelry every day, so I'd love to expand my options. This outfit is very sophisticated. I like it!","credit":"Cos white button-up, $89. Salvatore Ferragamo pleated leather skirt, $4,330. Rebecca Minkoff jewel-box-clip-clasp bangle, $58. Jennifer Meyer pyramid cuff, $6,800. Paul Andrew Lennox sandals, $895","photocredit":"Photograph by B. Blanchet for Bloomberg Businessweek; hair and makeup: Kyle Malone/Exclusive Artists; Illustrations by Cari Vander Yacht","imgType":"png","imgSmall":"9_small.png","imgLarge":"9_large.png","imgSize":null},
{"spread":2,"id":10,"type":"general","hed":"Tailored Flannel","dek":"With slightly relaxed jackets and slim-but-not-skinny pants, brushed-wool suits aren't just for Mad Men anymore.","credit":"Left: Brooklyn Tailors unstructured blazer, $595, and tailored trouser, $305. Gitman Bros. English spread shirt, $145. Tie Bar wool tie, $15. Jack Erwin bluchers, $195. Right: Gant by Michael Bastian MB pinstripe blazer, $795, and pants, $325. Todd Snyder dress shirt, $225. Tie Bar wool tie, $13.50. J.Crew Ludlow wingtips, $318","photocredit":"Photograph by Jody Rogac for Bloomberg Businessweek; hair and makeup: Kyle Malone/Exclusive Artists","imgType":"png","imgSmall":"10_small.png","imgLarge":"10_large.png","imgSize":null},
{"spread":2,"id":11,"type":"general","hed":"A Dandy-ish Scarf","dek":"Use one in place of a tie to lighten up a dark topcoat. Burberry's bottle-green cashmere version ($1,250) is on the ultrahigh end, but maybe that means you won't lose it in a cab.","credit":"","photocredit":"Photograph by B. Blanchet for Bloomberg Businessweek","imgType":"png","imgSmall":"11_small.png","imgLarge":"11_large.png","imgSize":null},
{"spread":2,"id":12,"type":"guide","hed":"Printed Pants","dek":"Drapey, colorful trousers, stocked in women's stores since last spring, are sticking around for fall. In expensive silks and more affordable poly-blend fabrics, they are an unexpected match with fall's crew neck sweaters and suede boots. Opt for subtle prints at the office.","credit":"","photocredit":"Illustrations by Cari Vander Yacht","imgType":"png","imgSmall":"12_small.png","imgLarge":"12_large.png","imgSize":null},
{"spread":2,"id":13,"type":"general","hed":"Less Formal Fur Coats","dek":"New versions aren't like the ones your mom wore: They're short and sleek, with clean lines that elevate skinny jeans and pencil skirts. Try one in a light color, like this Yves Salomon stunner. <strong>Inset: … On Second Thought, Go With Faux</strong> Fake fur is best for those with ethical concerns or tighter budgets: The real one costs 43(!) times more than this Zara knockoff.","credit":"Yves Salomon pink beaver coat, $7,273. Calvin Klein windowpane blouse, $70. Frame Le Skinny denim jeans, $200. Jimmy Choo Mimi pumps, $595. Inset: Zara faux fur coat, $169","photocredit":"Photograph by Geordie Wood for Bloomberg Businessweek; hair and makeup: Jessi Butterfield","imgType":"png","imgSmall":"13_small.png","imgLarge":"13_large.png","imgSize":null},
{"spread":3,"id":15,"type":"general","hed":"Colorful Knee-High Boots","dek":"Rounded toes, chunky heels, and jewel-toned leather make these standouts. Have a third-party cobbler (not the store) waterproof them to protect from damaging snow.","credit":"Burgundy: Gianvito Rossi Mattie leather boots, $1,785. Olive: Bally knee-high boots, $1,795. Tan: Pedro García Beryl suede boots, $775","photocredit":"Photograph by Jody Rogac for Bloomberg Businessweek; soft-goods stylist: Elizabeth Osborn","imgType":"png","imgSmall":"15_small.png","imgLarge":"15_large.png","imgSize":null},
{"spread":3,"id":16,"type":"brand","hed":"J.Hilburn","dek":"Year established: 2007 Known for: Custom suits, shirts, and other preppy guy essentials, tailored in person and sold online Buy: Classic made-to-fit blazers like this unlined navy staple ($600)","credit":"","photocredit":"Photograph by Eva O'Leary for Bloomberg Businessweek; soft-goods stylist: John Olsen","imgType":"png","imgSmall":"16_small.png","imgLarge":"16_large.png","imgSize":null},
{"spread":3,"id":17,"type":"rant","hed":"The End of Crazy Socks","dek":"Bright pairs emerged over the past decade as a sign that men care about style. That's now well established, so go back to basics: Socks should be just lighter or darker than your pants, preferably plain, and hopefully inconspicuous.","credit":"","photocredit":"Photograph by Eva O'Leary for Bloomberg Businessweek; soft-goods stylist: John Olsen","imgType":"png","imgSmall":"17_small.png","imgLarge":"17_large.png","imgSize":null},
{"spread":3,"id":18,"type":"general","hed":"Superior Overcoats","dek":"Those gigantic Canadian puffers are ugly, and black's too depressing. Invest in a wool topper that's cut longer, with an interesting collar or lapels that help dress up clothes underneath. It's the one thing you'll wear almost every day this winter, so don't feel bad about spending a bit more than you might like—though affordable options, such as the Cos one below, do exist.","credit":"Green: Cos oversize coat, $290. Bottega Veneta technical crepe dress, $4,100. Gianvito Rossi suede pumps, $250. Gray: Brioni single-breasted overcoat, $8,250. Hardy Amies gray plaid suit, $1,595. Emporio Armani wool tie, $145. Tod’s derbys, $645. Navy: Michael Kors Melton officer’s coat, $695. Rag & Bone Trevor crew, $350. DKNY white cotton button-down, $65. A.P.C. petit standard jeans, $185. H.E. by Mango bluchers, $129.99. Aqua: Apiece Apart Esta coat, $595. Jenni Kayne overlap top, $325. Zero + Maria Cornejo Madi skirt, $695. Manolo Blahnik Marcafac, $695. Eddie Borgo bell drop earrings, $100","photocredit":"Photographs by B. Blanchet for Bloomberg Businessweek; hair and makeup: Kyle Malone/Exclusive Artists","imgType":"gif","imgSmall":"18_small.gif","imgLarge":"18_large.gif","imgSize":null},
{"spread":3,"id":19,"type":"guide","hed":"Allover Patterned Dresses","dek":"Different from other printed frocks, these have a single motif spanning the entire garment rather than a small, repeating design. Wear one to exude confidence during a big presentation, or pair it with a cardigan to brighten up your Monday morning.","credit":"","photocredit":"Illustration by Cari Vander Yacht","imgType":"png","imgSmall":"19_small.png","imgLarge":"19_large.png","imgSize":null},
{"spread":3,"id":20,"type":"experiment","hed":"A Long Blazer","dek":"Oversize blazers, done right, look impossibly chic. And impossible to pull off yourself. Can someone who's not 5 foot 10 wear one without resembling a kid in Mom's clothes? I paired mine, an AllSaints Calia blazer ($415), which hits at the lower hip, with a cream and black polka dot miniskirt from J.Crew and a long-sleeve gray T-shirt from Cos. Even though I'm short, the blazer looked great—sophisticated and not too slouchy. The trick is to get one that's fitted in the shoulders and wear it with a sleeker silhouette underneath. If you roll up the sleeves—or buy them prerolled, like this one—the jacket's also less likely to overwhelm your frame. —Emma Rosenblum","credit":"","photocredit":"Photograph by B. Blanchet for Bloomberg Businessweek; hair and makeup: Kyle Malone/Exclusive Artists","imgType":"png","imgSmall":"20_small.png","imgLarge":"20_large.png","imgSize":null},
{"spread":3,"id":21,"type":"general","hed":"A Bob With Bounce, A Small Swoop","dek":"Women: Get your hair cut above the shoulders, and ","credit":"","photocredit":"Photograph by B. Blanchet for Bloomberg Businessweek; hair and makeup: Kyle Malone/Exclusive Artists","imgType":"png","imgSmall":"21_small.png","imgLarge":"21_large.png","imgSize":null},
{"spread":3,"id":23,"type":"general","hed":"Almost Invisible Nail Polish","dek":"After seasons of neon and nail art, nude varnish looks elegant. Find one that's a shade lighter or darker than your skin tone. It shouldn't match exactly.","credit":"","photocredit":"Photograph by Eva O'Leary for Bloomberg Businessweek; soft-goods stylist: John Olsen","imgType":"png","imgSmall":"23_small.png","imgLarge":"23_large.png","imgSize":null},
{"spread":3,"id":24,"type":"quote","hed":"Katia Beauchamp","dek":"Try a face mist. It tightens features and makes you look more awake.","credit":"","photocredit":"","imgType":"png","imgSmall":"24_small.png","imgLarge":"24_large.png","imgSize":null},
{"spread":3,"id":25,"type":"general","hed":"Not Jeans. Not Chinos. Trousers.","dek":"Up your game with well-cut dress pants. A glen plaid or subtle check looks great with a plain shirt or polo. Finish it all with heavy-soled brogues.","credit":"Left: Joseph dash trousers, $374. Hardy Amies gray peacoat, $1,295. Hugo Boss grid shirt, $155. Giorgio Armani belt, $375. Christian Louboutin brogues, $1,275. Right: Hardy Amies grid trousers, $1,595 (entire suit). Joseph chunky stitch polo, $540. Burberry polished brogues, $695. Uniform Wares watch, $375. Brooks Brothers ribbed crew socks, $19.50","photocredit":"Photograph by Geordie Wood for Bloomberg Businessweek","imgType":"png","imgSmall":"25_small.png","imgLarge":"25_large.png","imgSize":null},
{"spread":4,"id":26,"type":"general","hed":"The New Briefcase: 16 Structured Satchels for Men and Women ","dek":"This season's best bags are big enough to hold more than ","credit":"1. Lotuff zip-top briefcase, $680. 2. Sophie Hulme tote bag, $975. 3. Filson leather brief, $785. 4. Marni metal and calf-leather bag, $2,140. 5. Ralph Lauren Cooper black briefcase, $2,500. 6. Billykirk schoolboy satchel, $365. 7. Prada leather bag, $2,600. 8. Mulberry Somerton briefcase, $2,500. 9. Zara tricolor bowling bag, $99.90. 10. Claire Vivier suede Sandrine bag, $483. 11. Proenza Schouler Elliot shoulder bag, $6,975. 12. Bally corner MD handbag, $1,695. 13. Ann Taylor mini satchel, $158. 14. Valextra portfolio briefcase, $2,230. 15. Paul Smith leather shoulder bag, $1,230. 16. Time's Arrow Helene bag, $795","photocredit":"Photograph by Geordie Wood for Bloomberg Businessweek; soft-goods stylist: Elizabeth Osborn","imgType":"png","imgSmall":"26_small.png","imgLarge":"26_large.png","imgSize":null},
{"spread":4,"id":28,"type":"experiment","hed":"A Hefty Turtleneck","dek":"Too lightweight, and you look like a mime. Too heavy, and you're auditioning for the L.L. Bean catalog. Still, there's something classy and European about a turtleneck, and this Bally one ($850) is great. The cashmere feels like a soft animal hugging your neck. The lines at the shoulder provide a flattering fit. Despite that, it isn't something I can recommend for any but the most self-assured of gentlemen. Yes, I was teased. And the bigger problem is that nothing looks good over the sweater or, of course, under it. It's just you. And your precious turtleneck. -K.S.","credit":"","photocredit":"Photograph by B. Blanchet for Bloomberg Businessweek; hair and makeup: Kyle Malone/Exclusive Artists","imgType":"png","imgSmall":"28_small.png","imgLarge":"28_large.png","imgSize":null},
{"spread":4,"id":29,"type":"brand","hed":"Byredo","dek":"Year established: 2006 Known for: Slightly off-kilter fragrances for men and women that won't offend co-workers but will improve your day Buy: Musky, floral Mojave Ghost ($145)","credit":"","photocredit":"Photograph by Eva O'Leary for Bloomberg Businessweek","imgType":"png","imgSmall":"29_small.png","imgLarge":"29_large.png","imgSize":null},
{"spread":4,"id":30,"type":"general","hed":"Simpler Sneakers","dek":"New Balance has become status quo among tech dudes, so put yours on ice. Instead, go for a luxe riff on Adidas's classic Stan Smith. This one, the Royale in stark white ($159), is from Greats, an Internet startup that makes its pliable leather kicks in Italy.","credit":"","photocredit":"","imgType":"png","imgSmall":"30_small.png","imgLarge":"30_large.png","imgSize":null},
{"spread":4,"id":31,"type":"general","hed":"Monochrome for Men","dek":"Wearing one neutral from head to toe is a surprisingly versatile strategy, especially if you've got a complicated schedule. Stick to navy, charcoal, or black, then mix up the textures to keep from looking like a human paint swatch. Wake up, choose your color, and go.","credit":"Navy: Ovadia & Sons houndstooth flannel jacket, $1,495. Club Monaco classic fit shirt, $59. Nudie Alf straight-leg jeans, $199. Florsheim oxford shoes, $175. Black: Marni overcoat, $1,810. Todd Snyder cable crew sweater, $395. Salvatore Ferragamo wool trousers, $900. Robert Clergerie oxford shoes, $595","photocredit":"Photograph by B. Blanchet for Bloomberg Businessweek; hair and makeup: Kyle Malone/Exclusive Artists","imgType":"gif","imgSmall":"31_small.gif","imgLarge":"31_large.gif","imgSize":null},
{"spread":5,"id":32,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"32_small.png","imgLarge":"32_large.png","imgSize":null},
{"spread":5,"id":33,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"gif","imgSmall":"33_small.gif","imgLarge":"33_large.gif","imgSize":null},
{"spread":5,"id":34,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"gif","imgSmall":"34_small.gif","imgLarge":"34_large.gif","imgSize":null},
{"spread":5,"id":35,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"gif","imgSmall":"35_small.gif","imgLarge":"35_large.gif","imgSize":null},
{"spread":5,"id":36,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"gif","imgSmall":"36_small.gif","imgLarge":"36_large.gif","imgSize":null},
{"spread":5,"id":38,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"38_small.png","imgLarge":"38_large.png","imgSize":null},
{"spread":5,"id":39,"type":"quote","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"39_small.png","imgLarge":"39_large.png","imgSize":null},
{"spread":5,"id":40,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"40_small.png","imgLarge":"40_large.png","imgSize":null},
{"spread":6,"id":41,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"41_small.png","imgLarge":"41_large.png","imgSize":null},
{"spread":6,"id":42,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"42_small.png","imgLarge":"42_large.png","imgSize":null},
{"spread":6,"id":43,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"43_small.png","imgLarge":"43_large.png","imgSize":null},
{"spread":6,"id":44,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"44_small.png","imgLarge":"44_large.png","imgSize":null},
{"spread":6,"id":45,"type":"quote","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"45_small.png","imgLarge":"45_large.png","imgSize":null},
{"spread":6,"id":46,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"46_small.png","imgLarge":"46_large.png","imgSize":null},
{"spread":6,"id":47,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"47_small.png","imgLarge":"47_large.png","imgSize":null},
{"spread":6,"id":48,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"48_small.png","imgLarge":"48_large.png","imgSize":null},
{"spread":6,"id":49,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"49_small.png","imgLarge":"49_large.png","imgSize":null},
{"spread":6,"id":50,"type":"","hed":"","dek":"","credit":"","photocredit":"","imgType":"png","imgSmall":"50_small.png","imgLarge":"50_large.png","imgSize":null}];

data.forEach(function(value, index) {
  getImageSize(value.imgSmall, this, function(item, size) {
    data[index].size = size;
    // item.imgSize = size;
  });
})

var masonry,
    templateItem,
    templateQuote,
    $container;

/*
// random number generators for fixtures
var width = d3.random.normal(350, 100);
var height = d3.random.normal(350, 100);
var characters = d3.random.normal(160, 60);
var lorem = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris sed velit eget eros ullamcorper lobortis id ac dui. Vivamus commodo pulvinar leo, ac consectetur arcu mattis vel. Donec dapibus, orci eget ullamcorper egestas, felis ex elementum est, ut fermentum leo tortor nec felis. Nulla euismod commodo dui, sed pretium tortor luctus nec. Integer rhoncus metus enim, et vehicula nulla ullamcorper eu.";

// random item fixture constructor
function Item(id) {
  var w = Math.round(width());
  var h = Math.round(height());
  var c = Math.round(characters());

  this.id = id;
  this.type = _.sample(["general", "could-you-wear-this", "illustrated-guide", "brand-to-know", "real-person-problem", "quote"]);
	this.hed = lorem.substr(0,c/4);
	this.dek = lorem.substr(0,c);
	this.credit = lorem.substr(0,c/2);
  this.imgSmall = "img/" + ('0' + id).slice(-2) + "_small.png";
  this.imgLarge = "img/" + ('0' + id).slice(-2) + "_large.png";
  getImageSize(this.imgSmall, this, function(item, size) {
    item.imgSize = size;
  });
}

// fill in fixtures
for(var i=1; i<=50; i++) {
  data.push(new Item(i));
}
*/

///////////////////////////////////////////////////

$( document ).ready(function() {
  if(inIframe()) $("body").addClass("iframed");

  // Read in templates
  templateItem = $("#template-item").html();
  templateQuote = $("#template-quote").html();

  // MASONRY (once images load)
  $container = $('#container').masonry({
    itemSelector: '.item',
    columnWidth: 1
  });

  // Load the initial 10 (kinda duplicate code...)
  var $items = getItems($("#container").children().length-1, 10);
  $container.masonryImagesReveal($items);

  // SOCIAL RULES EVERYTHING AROUND ME, SCREAM
  $('.popup-twitter').click(function() {shareTwitter(meta.shareText) } );
  $('.popup-linkedin').click(function() { shareLinkedIn(meta.shareText) } );
  $('.popup-facebook').click(function() { shareFacebook(meta.shareText) } );

  // Post-poll tweet (delegated event)
  $(document).on("click", ".poll .answer .tweet", function(event) {
    shareTwitter($(event.currentTarget).data("shareText"), document.URL.split("#")[0] + "#" + $(event.currentTarget).closest('.item').attr("id"));
  });

  // the unbearable weight of ANALYTICS OR IT DIDN'T HAPPEN!!!
  analytics(meta);

});

// delegated event, so it stays "live" (won't fire after poll is resolved)
$(document).on("click", ".poll.unresolved .answer", function(event) {

  var poll = $(event.target).closest('.poll');
  var answer = $(event.target).closest('.answer');
  var answerValue = answer.hasClass('yes');

  poll.removeClass("unresolved");
  poll.addClass("resolved");

  poll.find(".answer").addClass("final");
  answer.addClass("selected");
  answer.find('.progress').show();

  // send request to poll server
  postData = {
    app: 'fashion2014',
    questionId: poll.data('poll-id'),
    text: 'Could you wear this?',
    answers: [
      {id: 0, text: "Yes", vote: answerValue.toString()},
      {id: 1, text: "No", vote: (!answerValue).toString()}
    ]
  }

  $.post("http://bw-poll-server.herokuapp.com/api/vote", postData, function(returnData) {

    answer.find('.progress').hide();

    voteSum = returnData.question.answers.reduce(function(prev, value) { return prev + value.votes; }, 0);
    tally = [];
    returnData.question.answers.forEach(function(answer) {
      percentage = Math.round((answer.votes/voteSum)*100);
      answerEl = poll.find('[data-answer-id="'+answer.id+'"]');
      answerEl.css("width", percentage+"%");
      if(percentage==0) { answerEl.hide(); }
      answerEl.find(".percentage").text(percentage+"%");
      tally[answer.text] = percentage;
    })

    if(tally['Yes'] > 50) {
      if(answerValue) {
        // majority would wear, including user
        shareText = "I would wear this to work. Would you?";
      } else {
        // majority would wear, but user wouldn't
        shareText = "I can't believe people would go to work like this. I would never!";
      }
    } else {
      if(answerValue) {
        // majority wouldn't wear, but user would
        shareText = "I can't believe people wouldn't wear this. I would!";
      } else {
        // majority wouldn't wear, including user
        shareText = "Yeah, no one should wear this to work.";
      }
    }

    answer.find(".tweet").show().data("shareText", shareText);

  }, 'json');

})

$(window).scroll(function(event) {

  // terrible janky width-dependent (?!) parallax background scroll
  var y = $(window).scrollTop();
  $("body").css("background-position", "0% " + (y/100)+"%");

  // when you hit the bottom, load more
  if($(window).scrollTop() + $(window).height() == $(document).height()) {
    var $items = getItems($("#container").children().length-1, 10);
    if($items.length != 0) {
      // progressively reveal next items
      $container.masonryImagesReveal($items);
    } else {
      // nothing more to load, hide spinner
      $(".progressive-loading-indicator").hide();
    }
  }
})

// fetch slices of items and return as jquery object
// from http://codepen.io/desandro/pen/kwsJb
function getItems(offset, limit) {
  var itemsHTML = '';
  var items = data.slice(offset, offset+limit);
  items.forEach(function(item) {
    if(item.type == "quote") {
      itemsHTML += _.template(templateQuote, {"item": item});
    } else {
      itemsHTML += _.template(templateItem, {"item": item});
    }
  })
  return $(itemsHTML);
}

// from http://codepen.io/desandro/pen/kwsJb
$.fn.masonryImagesReveal = function( $items ) {
  var msnry = this.data('masonry');
  var itemSelector = msnry.options.itemSelector;
  // hide by default
  $items.hide();
  // append to container
  this.append( $items );
  $items.imagesLoaded().progress( function( imgLoad, image ) {
    // get item
    // image is imagesLoaded class, not <img>, <img> is image.img
    var $item = $( image.img ).parents( itemSelector );
    // un-hide item
    $item.show();
    // masonry does its thing
    msnry.appended( $item );
  });

  return this;
};

// from http://stackoverflow.com/a/1093364/120290
function getImageSize(src, item, callback) {
  // create an offscreen image that isn't scaled but contains the same image.
  var img = new Image();
  img.src = src;

  // check if the image has finished loading
  img.onload = function() {
    callback(item, {width: img.width, height: img.height});
  };
}
